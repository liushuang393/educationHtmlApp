<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆå­¦ç¿’æ¼”ç¤ºã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆå­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚´ -->
    <div style="display: flex; justify-content: flex-start; align-items: center; margin-top: 20px; margin-bottom: 20px; margin-left: 20px;">
      <svg width="60" height="60" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="8" y="16" width="28" height="48" rx="6" fill="#3B82F6" stroke="#2563EB" stroke-width="2"/>
        <rect x="44" y="16" width="28" height="48" rx="6" fill="#60A5FA" stroke="#2563EB" stroke-width="2"/>
        <path d="M12 24 Q22 32 40 24 Q58 32 68 24" stroke="#1E40AF" stroke-width="2" fill="none"/>
        <path d="M12 56 Q22 48 40 56 Q58 48 68 56" stroke="#1E40AF" stroke-width="2" fill="none"/>
        <rect x="38" y="16" width="4" height="48" rx="2" fill="#2563EB"/>
        <circle cx="40" cy="40" r="6" fill="#fff" stroke="#2563EB" stroke-width="2"/>
        <rect x="36" y="38" width="8" height="2" rx="1" fill="#2563EB"/>
        <rect x="39" y="34" width="2" height="8" rx="1" fill="#2563EB"/>
      </svg>
    </div>

    <div class="container">
        <!-- AI API ã¨ãƒ¢ãƒ‡ãƒ«é¸æŠ - å³ä¸Šã«ç§»å‹• -->
        <div class="api-selector-top-right">
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <div class="api-selector">
                    <label for="apiSelect">AI API:</label>
                    <select id="apiSelect" onchange="onAPIChange()">
                        <option value="ollama">Ollama (ãƒ­ãƒ¼ã‚«ãƒ«)</option>
                        <option value="openai">OpenAI</option>
                        <option value="google">Google Gemini</option>
                        <option value="claude">Claude</option>
                    </select>
                </div>
                <div class="model-selector">
                    <label for="modelSelect">ãƒ¢ãƒ‡ãƒ«:</label>
                    <select id="modelSelect" onchange="onModelChange()">
                        <!-- å‹•çš„ã«å…¥åŠ› -->
                    </select>
                </div>
            </div>
        </div>

        <div class="chat-panel">
            <div class="chat-header">
                <div class="header-controls">
                    <div style="flex: 1;">
                        <h1 id="chatTitle">ğŸ¤– ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆå­¦ç¿’ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</h1>
                        <p id="chatSubtitle">æ•°å­¦ã®è³ªå•ã‚’ã—ã¦ãã ã•ã„ã€‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã®èª¬æ˜ã‚’ç”Ÿæˆã—ã¾ã™</p>
                    </div>
                    <button class="language-toggle" onclick="switchToChinese()">
                        <span>ä¸­æ–‡</span>
                    </button>
                </div>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="message bot-message" id="welcomeMessage">
                    ã“ã‚“ã«ã¡ã¯ï¼ç§ã¯ã‚ãªãŸã®ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆå­¦ç¿’ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ã€Œãƒ”ã‚¿ã‚´ãƒ©ã‚¹ã®å®šç†ã‚’æ¼”ç¤ºã€ã€ŒäºŒæ¬¡é–¢æ•°ã‚’èª¬æ˜ã€ã€Œå††ã®é¢ç©å…¬å¼ã¨ã¯ã€ãªã©ã®æ•°å­¦ã®è³ªå•ã‚’ã—ã¦ãã ã•ã„ã€‚è©³ç´°ãªèª¬æ˜ã¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ¼”ç¤ºã‚’ç”Ÿæˆã—ã¾ã™ã€‚
                </div>
            </div>

            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." onkeypress="handleKeyPress(event)">
                <button class="send-btn" id="sendButton" onclick="sendMessage()">é€ä¿¡</button>
            </div>
        </div>
        
        <div class="demo-panel">
            <div class="demo-header">
                <h2 class="demo-title" id="demoTitle">æ•°å­¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ¼”ç¤º</h2>
                <button class="home-btn" id="homeBtn" onclick="goHome()" style="display: none;">ğŸ  ãƒ›ãƒ¼ãƒ </button>
            </div>

            <div class="demo-content" id="demoContent">
                <div class="welcome-screen">
                    <div class="welcome-title" id="welcomeTitle">ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆå­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ ã¸ã‚ˆã†ã“ãï¼</div>
                    <div class="welcome-text" id="welcomeText">å·¦å´ã®ãƒãƒ£ãƒƒãƒˆãƒœãƒƒã‚¯ã‚¹ã§è³ªå•ã™ã‚‹ã¨ã€ã“ã“ã«å¯¾å¿œã™ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ¼”ç¤ºãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>

                    <div class="knowledge-points-section">
                        <h3 class="section-title">çŸ¥è­˜ãƒã‚¤ãƒ³ãƒˆã‚’é¸æŠ</h3>
                        <div class="knowledge-grid">
                            <button class="knowledge-btn" onclick="quickQuestionByType('pythagorean')">
                                <div class="knowledge-icon">ğŸ“</div>
                                <div class="knowledge-title" id="btn1">ãƒ”ã‚¿ã‚´ãƒ©ã‚¹ã®å®šç†</div>
                                <div class="knowledge-desc">aÂ² + bÂ² = cÂ²</div>
                            </button>

                            <button class="knowledge-btn" onclick="quickQuestionByType('circle')">
                                <div class="knowledge-icon">â­•</div>
                                <div class="knowledge-title" id="btn2">å††ã®é¢ç©</div>
                                <div class="knowledge-desc">A = Ï€rÂ²</div>
                            </button>

                            <button class="knowledge-btn" onclick="quickQuestionByType('quadratic')">
                                <div class="knowledge-icon">ğŸ“ˆ</div>
                                <div class="knowledge-title" id="btn3">äºŒæ¬¡é–¢æ•°</div>
                                <div class="knowledge-desc">y = axÂ² + bx + c</div>
                            </button>

                            <button class="knowledge-btn" onclick="quickQuestionByType('trigonometry')">
                                <div class="knowledge-icon">ğŸ“Š</div>
                                <div class="knowledge-title" id="btn4">ä¸‰è§’é–¢æ•°</div>
                                <div class="knowledge-desc">sin, cos, tan</div>
                            </button>
                        </div>
                    </div>

                    <div class="or-divider">
                        <span class="or-text">ã¾ãŸã¯</span>
                    </div>

                    <div class="chat-prompt">
                        <div class="chat-prompt-icon">ğŸ’¬</div>
                        <div class="chat-prompt-text">å·¦å´ã®ãƒãƒ£ãƒƒãƒˆãƒœãƒƒã‚¯ã‚¹ã«è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
                    </div>

                    <div class="welcome-animation">
                        <div class="floating-icon">ğŸ”¢</div>
                        <div class="floating-icon">âˆ‘</div>
                        <div class="floating-icon">âˆ«</div>
                        <div class="floating-icon">âˆš</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ—¥æœ¬èªãƒšãƒ¼ã‚¸ã®è¨€èªè¨­å®šã‚’å¼·åˆ¶çš„ã«è¨­å®š
        window.pageLanguage = 'ja';
        currentLanguage = 'ja';

        // å‹•çš„ã«JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’é˜²ã
        const timestamp = Date.now();

        // æœ€åˆã«ç’°å¢ƒå¤‰æ•°ãƒ­ãƒ¼ãƒ€ãƒ¼ã‚’èª­ã¿è¾¼ã¿
        const envScript = document.createElement('script');
        envScript.src = 'env-loader.js?t=' + timestamp;
        document.head.appendChild(envScript);

        // æ¬¡ã«config.jsã‚’èª­ã¿è¾¼ã¿
        envScript.onload = function() {
            console.log('env-loader.js ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            const configScript = document.createElement('script');
            configScript.src = 'config.js?t=' + timestamp;
            document.head.appendChild(configScript);

            // script.jsã‚’èª­ã¿è¾¼ã¿ï¼ˆconfig.jsã®èª­ã¿è¾¼ã¿å®Œäº†ã‚’å¾…ã¤ï¼‰
            configScript.onload = async function() {
                console.log('config.js ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');

                // ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿è¾¼ã¿
                if (window.loadEnvironmentVariables) {
                    await window.loadEnvironmentVariables();
                }

                const mainScript = document.createElement('script');
                mainScript.src = 'script.js?t=' + timestamp;
                document.head.appendChild(mainScript);

                // APIè¨­å®šãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®èª­ã¿è¾¼ã¿å®Œäº†ã‚’ç¢ºèªã—ã¦ã‹ã‚‰é¸æŠå™¨ã‚’åˆæœŸåŒ–
                setTimeout(function() {
                    if (window.apiConfigManager) {
                        console.log('APIé¸æŠå™¨ã‚’åˆæœŸåŒ–ä¸­...');
                        initializeAPISelector();
                    } else {
                        console.error('APIè¨­å®šãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒã¾ã èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                        // å†è©¦è¡Œ
                        setTimeout(function() {
                            if (window.apiConfigManager) {
                                console.log('é…å»¶APIé¸æŠå™¨åˆæœŸåŒ–...');
                                initializeAPISelector();
                            } else {
                                console.error('APIè¨­å®šãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒæœ€çµ‚çš„ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã›ã‚“ã§ã—ãŸ');
                            }
                        }, 500);
                    }
                }, 200);
            };
        };
    </script>
    <style>
        /* APIé¸æŠå™¨ã‚¹ã‚¿ã‚¤ãƒ« - å³ä¸Šè§’ã«é…ç½® */
        .api-selector-top-right {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 15px;
            align-items: flex-start;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(5px);
        }

        .api-selector-top-right .api-selector,
        .api-selector-top-right .model-selector {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .api-selector-top-right .api-selector label,
        .api-selector-top-right .model-selector label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
            white-space: nowrap;
        }

        .api-selector-top-right .api-selector select,
        .api-selector-top-right .model-selector select {
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            font-size: 13px;
            min-width: 120px;
            cursor: pointer;
        }

        .api-selector-top-right .api-selector select:focus,
        .api-selector-top-right .model-selector select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }

        .api-selector-top-right .api-selector select:hover,
        .api-selector-top-right .model-selector select:hover {
            border-color: #007bff;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ */
        @media (max-width: 768px) {
            .api-selector-top-right {
                position: relative;
                top: auto;
                right: auto;
                margin: 10px;
                justify-content: center;
            }
        }
    </style>

    <script>
        // æ—¥æœ¬èªãƒšãƒ¼ã‚¸ã®è¨€èªè¨­å®šã‚’å¼·åˆ¶çš„ã«è¨­å®š
        window.pageLanguage = 'ja';

        // APIé¸æŠå™¨é–¢é€£é–¢æ•°
        function initializeAPISelector() {
            if (!window.apiConfigManager) {
                console.error('APIè¨­å®šãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }

            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé¸æŠã®APIã‚’è¨­å®š
            const apiSelect = document.getElementById('apiSelect');
            apiSelect.value = window.apiConfigManager.defaultAPI;

            // ãƒ¢ãƒ‡ãƒ«é¸æŠå™¨ã‚’åˆæœŸåŒ–
            updateModelSelector();
        }

        function updateModelSelector() {
            const apiSelect = document.getElementById('apiSelect');
            const modelSelect = document.getElementById('modelSelect');

            if (!apiSelect || !modelSelect) {
                console.error('APIé¸æŠå™¨ã¾ãŸã¯ãƒ¢ãƒ‡ãƒ«é¸æŠå™¨è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }

            const selectedAPI = apiSelect.value;
            console.log('ãƒ¢ãƒ‡ãƒ«é¸æŠå™¨ã‚’æ›´æ–°ã€ç¾åœ¨ã®API:', selectedAPI);

            if (!window.apiConfigManager || !window.apiConfigManager.configs[selectedAPI]) {
                console.error('APIè¨­å®šãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¾ãŸã¯è¨­å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', selectedAPI);
                return;
            }

            const config = window.apiConfigManager.configs[selectedAPI];
            const availableModels = config.availableModels || [config.model];
            console.log('åˆ©ç”¨å¯èƒ½ãªãƒ¢ãƒ‡ãƒ«:', availableModels);

            // æ—¢å­˜ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢
            modelSelect.innerHTML = '';

            // åˆ©ç”¨å¯èƒ½ãªãƒ¢ãƒ‡ãƒ«ã‚’è¿½åŠ 
            availableModels.forEach(model => {
                const option = document.createElement('option');
                option.value = model;
                option.textContent = model;
                if (model === config.model) {
                    option.selected = true;
                }
                modelSelect.appendChild(option);
            });

            console.log('ãƒ¢ãƒ‡ãƒ«é¸æŠå™¨ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ•°:', modelSelect.options.length);
        }

        function onAPIChange() {
            const apiSelect = document.getElementById('apiSelect');
            const selectedAPI = apiSelect.value;

            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆAPIã«è¨­å®š
            if (window.apiConfigManager) {
                window.apiConfigManager.setDefaultAPI(selectedAPI);
                updateModelSelector();
                console.log(`${selectedAPI} APIã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ`);
            }
        }

        function onModelChange() {
            const apiSelect = document.getElementById('apiSelect');
            const modelSelect = document.getElementById('modelSelect');
            const selectedAPI = apiSelect.value;
            const selectedModel = modelSelect.value;

            // APIã®ãƒ¢ãƒ‡ãƒ«ã‚’è¨­å®š
            if (window.apiConfigManager) {
                window.apiConfigManager.setAPIModel(selectedAPI, selectedModel);
                console.log(`${selectedAPI} ã®ãƒ¢ãƒ‡ãƒ«ã‚’ ${selectedModel} ã«è¨­å®šã—ã¾ã—ãŸ`);
            }
        }

        // ä¸­å›½èªç‰ˆã«åˆ‡ã‚Šæ›¿ãˆ
        function switchToChinese() {
            window.location.href = 'learning_system_zh.html';
        }

        // è¨€èªåˆæœŸåŒ–ã¯script.jsã®DOMContentLoadedã‚¤ãƒ™ãƒ³ãƒˆã§å‡¦ç†ã€é‡è¤‡å‘¼ã³å‡ºã—ã‚’å›é¿
    </script>
</body>
</html>
