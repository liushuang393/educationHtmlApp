<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½æ•™å­¦æ¼”ç¤ºç³»ç»Ÿ</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- æ™ºèƒ½æ•™å­¦ç³»ç»ŸLogo -->
    <div style="display: flex; justify-content: flex-start; align-items: center; margin-top: 20px; margin-bottom: 20px; margin-left: 20px;">
      <svg width="60" height="60" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="8" y="16" width="28" height="48" rx="6" fill="#3B82F6" stroke="#2563EB" stroke-width="2"/>
        <rect x="44" y="16" width="28" height="48" rx="6" fill="#60A5FA" stroke="#2563EB" stroke-width="2"/>
        <path d="M12 24 Q22 32 40 24 Q58 32 68 24" stroke="#1E40AF" stroke-width="2" fill="none"/>
        <path d="M12 56 Q22 48 40 56 Q58 48 68 56" stroke="#1E40AF" stroke-width="2" fill="none"/>
        <rect x="38" y="16" width="4" height="48" rx="2" fill="#2563EB"/>
        <circle cx="40" cy="40" r="6" fill="#fff" stroke="#2563EB" stroke-width="2"/>
        <rect x="36" y="38" width="8" height="2" rx="1" fill="#2563EB"/>
        <rect x="39" y="34" width="2" height="8" rx="1" fill="#2563EB"/>
      </svg>
    </div>

    <div class="container">
        <!-- AI API å’Œæ¨¡å‹é€‰æ‹© - ç§»åŠ¨åˆ°å³ä¸Šè§’ -->
        <div class="api-selector-top-right">
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <div class="api-selector">
                    <label for="apiSelect">AI API:</label>
                    <select id="apiSelect" onchange="onAPIChange()">
                        <option value="ollama">Ollama (æœ¬åœ°)</option>
                        <option value="openai">OpenAI</option>
                        <option value="google">Google Gemini</option>
                        <option value="claude">Claude</option>
                    </select>
                </div>
                <div class="model-selector">
                    <label for="modelSelect">æ¨¡å‹:</label>
                    <select id="modelSelect" onchange="onModelChange()">
                        <!-- åŠ¨æ€å¡«å…… -->
                    </select>
                </div>
            </div>
        </div>

        <div class="chat-panel">
            <div class="chat-header">
                <div class="header-controls">
                    <div style="flex: 1;">
                        <h1 id="chatTitle">ğŸ¤– æ™ºèƒ½æ•™å­¦åŠ©æ‰‹</h1>
                        <p id="chatSubtitle">é—®æˆ‘ä»»ä½•æ•°å­¦é—®é¢˜ï¼Œæˆ‘ä¼šä¸ºæ‚¨ç”ŸæˆåŠ¨ç”»æ¼”ç¤º</p>
                    </div>
                    <button class="language-toggle" onclick="switchToJapanese()">
                        <span>æ—¥æœ¬èª</span>
                    </button>
                </div>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="message bot-message" id="welcomeMessage">
                    ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„æ™ºèƒ½æ•™å­¦åŠ©æ‰‹ã€‚ä½ å¯ä»¥é—®æˆ‘æ•°å­¦é—®é¢˜ï¼Œæ¯”å¦‚"æ¼”ç¤ºå‹¾è‚¡å®šç†"ã€"è§£é‡ŠäºŒæ¬¡å‡½æ•°"ã€"ä»€ä¹ˆæ˜¯åœ†çš„é¢ç§¯å…¬å¼"ç­‰ï¼Œæˆ‘ä¼šä¸ºä½ ç”Ÿæˆè¯¦ç»†çš„è§£é‡Šå’ŒåŠ¨ç”»æ¼”ç¤ºã€‚
                </div>
            </div>

            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="è¾“å…¥ä½ çš„é—®é¢˜..." onkeypress="handleKeyPress(event)">
                <button class="send-btn" id="sendButton" onclick="sendMessage()">å‘é€</button>
            </div>
        </div>
        
        <div class="demo-panel">
            <div class="demo-header">
                <h2 class="demo-title" id="demoTitle">æ•°å­¦åŠ¨ç”»æ¼”ç¤º</h2>
                <button class="home-btn" id="homeBtn" onclick="goHome()" style="display: none;">ğŸ  è¿”å›ä¸»é¡µ</button>
            </div>

            <div class="demo-content" id="demoContent">
                <div class="welcome-screen">
                    <div class="welcome-title" id="welcomeTitle">æ¬¢è¿ä½¿ç”¨æ™ºèƒ½æ•™å­¦ç³»ç»Ÿï¼</div>
                    <div class="welcome-text" id="welcomeText">åœ¨å·¦ä¾§èŠå¤©æ¡†ä¸­æé—®ï¼Œè¿™é‡Œå°†æ˜¾ç¤ºç›¸åº”çš„åŠ¨ç”»æ¼”ç¤º</div>

                    <div class="knowledge-points-section">
                        <h3 class="section-title">é€‰æ‹©çŸ¥è¯†ç‚¹</h3>
                        <div class="knowledge-grid">
                            <button class="knowledge-btn" onclick="quickQuestionByType('pythagorean')">
                                <div class="knowledge-icon">ğŸ“</div>
                                <div class="knowledge-title" id="btn1">å‹¾è‚¡å®šç†</div>
                                <div class="knowledge-desc">aÂ² + bÂ² = cÂ²</div>
                            </button>

                            <button class="knowledge-btn" onclick="quickQuestionByType('circle')">
                                <div class="knowledge-icon">â­•</div>
                                <div class="knowledge-title" id="btn2">åœ†çš„é¢ç§¯</div>
                                <div class="knowledge-desc">A = Ï€rÂ²</div>
                            </button>

                            <button class="knowledge-btn" onclick="quickQuestionByType('quadratic')">
                                <div class="knowledge-icon">ğŸ“ˆ</div>
                                <div class="knowledge-title" id="btn3">äºŒæ¬¡å‡½æ•°</div>
                                <div class="knowledge-desc">y = axÂ² + bx + c</div>
                            </button>

                            <button class="knowledge-btn" onclick="quickQuestionByType('trigonometry')">
                                <div class="knowledge-icon">ğŸ“Š</div>
                                <div class="knowledge-title" id="btn4">ä¸‰è§’å‡½æ•°</div>
                                <div class="knowledge-desc">sin, cos, tan</div>
                            </button>
                        </div>
                    </div>

                    <div class="or-divider">
                        <span class="or-text">æˆ–è€…</span>
                    </div>

                    <div class="chat-prompt">
                        <div class="chat-prompt-icon">ğŸ’¬</div>
                        <div class="chat-prompt-text">åœ¨å·¦ä¾§èŠå¤©æ¡†ä¸­è¾“å…¥æ‚¨çš„é—®é¢˜</div>
                    </div>

                    <div class="welcome-animation">
                        <div class="floating-icon">ğŸ”¢</div>
                        <div class="floating-icon">âˆ‘</div>
                        <div class="floating-icon">âˆ«</div>
                        <div class="floating-icon">âˆš</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // åŠ¨æ€åŠ è½½JavaScriptæ–‡ä»¶ï¼Œæ·»åŠ æ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜
        const timestamp = Date.now();

        // é¦–å…ˆåŠ è½½ç¯å¢ƒå˜é‡åŠ è½½å™¨
        const envScript = document.createElement('script');
        envScript.src = 'env-loader.js?t=' + timestamp;
        document.head.appendChild(envScript);

        // ç„¶ååŠ è½½config.js
        envScript.onload = function() {
            console.log('env-loader.js ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            const configScript = document.createElement('script');
            configScript.src = 'config.js?t=' + timestamp;
            document.head.appendChild(configScript);

            // script.jsã‚’èª­ã¿è¾¼ã¿ï¼ˆconfig.jsã®èª­ã¿è¾¼ã¿å®Œäº†ã‚’å¾…ã¤ï¼‰
            configScript.onload = async function() {
                console.log('config.js ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');

                // ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿è¾¼ã¿
                if (window.loadEnvironmentVariables) {
                    await window.loadEnvironmentVariables();
                }

                const mainScript = document.createElement('script');
                mainScript.src = 'script.js?t=' + timestamp;
                document.head.appendChild(mainScript);

                // APIè¨­å®šãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®èª­ã¿è¾¼ã¿å®Œäº†ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’åˆæœŸåŒ–
                setTimeout(function() {
                    if (window.apiConfigManager) {
                        console.log('APIã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’åˆæœŸåŒ–ä¸­...');
                        initializeAPISelector();
                    } else {
                        console.error('APIè¨­å®šãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒã¾ã èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                        // å†è©¦è¡Œ
                        setTimeout(function() {
                            if (window.apiConfigManager) {
                                console.log('é…å»¶APIã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼åˆæœŸåŒ–...');
                                initializeAPISelector();
                            } else {
                                console.error('APIè¨­å®šãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒæœ€çµ‚çš„ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã›ã‚“ã§ã—ãŸ');
                            }
                        }, 500);
                    }
                }, 200);
            };
        };
    </script>
    <style>
        /* APIé€‰æ‹©å™¨æ ·å¼ - å³ä¸Šè§’å®šä½ */
        .api-selector-top-right {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 15px;
            align-items: flex-start;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(5px);
        }

        .api-selector-top-right .api-selector,
        .api-selector-top-right .model-selector {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .api-selector-top-right .api-selector label,
        .api-selector-top-right .model-selector label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
            white-space: nowrap;
        }

        .api-selector-top-right .api-selector select,
        .api-selector-top-right .model-selector select {
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            font-size: 13px;
            min-width: 120px;
            cursor: pointer;
        }

        .api-selector-top-right .api-selector select:focus,
        .api-selector-top-right .model-selector select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }

        .api-selector-top-right .api-selector select:hover,
        .api-selector-top-right .model-selector select:hover {
            border-color: #007bff;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .api-selector-top-right {
                position: relative;
                top: auto;
                right: auto;
                margin: 10px;
                justify-content: center;
            }
        }
    </style>

    <script>
        // ä¸­å›½èªãƒšãƒ¼ã‚¸ã®è¨€èªè¨­å®šã‚’å¼·åˆ¶çš„ã«è¨­å®š
        window.pageLanguage = 'zh';

        // APIã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼é–¢é€£é–¢æ•°
        function initializeAPISelector() {
            if (!window.apiConfigManager) {
                console.error('APIè¨­å®šãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }

            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé¸æŠã®APIã‚’è¨­å®š
            const apiSelect = document.getElementById('apiSelect');
            apiSelect.value = window.apiConfigManager.defaultAPI;

            // ãƒ¢ãƒ‡ãƒ«ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’åˆæœŸåŒ–
            updateModelSelector();
        }

        function updateModelSelector() {
            const apiSelect = document.getElementById('apiSelect');
            const modelSelect = document.getElementById('modelSelect');

            if (!apiSelect || !modelSelect) {
                console.error('APIã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã¾ãŸã¯ãƒ¢ãƒ‡ãƒ«ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }

            const selectedAPI = apiSelect.value;
            console.log('ãƒ¢ãƒ‡ãƒ«ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’æ›´æ–°ã€ç¾åœ¨ã®API:', selectedAPI);

            if (!window.apiConfigManager || !window.apiConfigManager.configs[selectedAPI]) {
                console.error('APIè¨­å®šãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¾ãŸã¯è¨­å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', selectedAPI);
                return;
            }

            const config = window.apiConfigManager.configs[selectedAPI];
            const availableModels = config.availableModels || [config.model];
            console.log('åˆ©ç”¨å¯èƒ½ãªãƒ¢ãƒ‡ãƒ«:', availableModels);

            // æ—¢å­˜ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢
            modelSelect.innerHTML = '';

            // åˆ©ç”¨å¯èƒ½ãªãƒ¢ãƒ‡ãƒ«ã‚’è¿½åŠ 
            availableModels.forEach(model => {
                const option = document.createElement('option');
                option.value = model;
                option.textContent = model;
                if (model === config.model) {
                    option.selected = true;
                }
                modelSelect.appendChild(option);
            });

            console.log('ãƒ¢ãƒ‡ãƒ«ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ•°:', modelSelect.options.length);
        }

        function onAPIChange() {
            const apiSelect = document.getElementById('apiSelect');
            const selectedAPI = apiSelect.value;

            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆAPIã«è¨­å®š
            if (window.apiConfigManager) {
                window.apiConfigManager.setDefaultAPI(selectedAPI);
                updateModelSelector();
                console.log(`${selectedAPI} APIã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ`);
            }
        }

        function onModelChange() {
            const apiSelect = document.getElementById('apiSelect');
            const modelSelect = document.getElementById('modelSelect');
            const selectedAPI = apiSelect.value;
            const selectedModel = modelSelect.value;

            // APIã®ãƒ¢ãƒ‡ãƒ«ã‚’è¨­å®š
            if (window.apiConfigManager) {
                window.apiConfigManager.setAPIModel(selectedAPI, selectedModel);
                console.log(`${selectedAPI} ã®ãƒ¢ãƒ‡ãƒ«ã‚’ ${selectedModel} ã«è¨­å®šã—ã¾ã—ãŸ`);
            }
        }

        // æ—¥æœ¬èªç‰ˆã«åˆ‡ã‚Šæ›¿ãˆ
        function switchToJapanese() {
            window.location.href = 'learning_system_ja.html';
        }

        // è¯­è¨€åˆå§‹åŒ–ç”±script.jsçš„DOMContentLoadedäº‹ä»¶å¤„ç†ï¼Œé¿å…é‡å¤è°ƒç”¨
    </script>
</body>
</html>
